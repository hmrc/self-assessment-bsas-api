summary: Submit an Adjustment to a Self-Employment Business Summary
description: |
  This endpoint allows a developer to provide accounting adjustments against a specified Business Source Adjustable Summary (BSAS) using its unique identifier. The BSAS ID used must be for a self-employment business that has not been previously adjusted.
  
  ### Test data
  Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.  

  | Header Value (Gov-Test-Scenario)                     | Scenario                                                                             |
  |------------------------------------------------------|--------------------------------------------------------------------------------------|
  | N/A - DEFAULT                                        | Simulates a successful response for a self-employment.                               |
  | NOT_SELF_EMPLOYMENT                                  | Simulates the error response where the BSAS ID is for an incorrect type of business. |
  | SUMMARY_STATUS_INVALID                               | Simulates the error response where the summary is invalid and cannot be adjusted.    |
  | SUMMARY_STATUS_SUPERSEDED                            | Simulates the error response where the summary is superseded and cannot be adjusted. |
  | BSAS_ALREADY_ADJUSTED                                | Simulates the error response where the summary has already been adjusted.            |
  | SELF_EMPLOYMENT_OVER_CONSOLIDATED_EXPENSES_THRESHOLD | Simulates the error response where the cumulative turnover amount exceeds the consolidated expenses threshold. |
  | RULE_TRADING_INCOME_ALLOWANCE_CLAIMED                | Simulates the error response where a claim for trading income allowance was made - cannot also have expenses.      |
  | RESULTING_VALUE_NOT_PERMITTED                        | Simulates the error response that may occur if one or more adjustments submitted would result in a negative value. |
  | NOT_FOUND                                            | Simulates the scenario where no data was found.                                      |

tags:
  - Self-employment business

parameters:
  - $ref: ./common/pathParameters.yaml#/components/parameters/nino
  - $ref: ./common/pathParameters.yaml#/components/parameters/bsasId
  - $ref: ./common/headers.yaml#/components/parameters/acceptJson
  - $ref: ./common/headers.yaml#/components/parameters/contentTypeJson
  - $ref: ./common/headers.yaml#/components/parameters/authorizationWriteScopeHeader
  - $ref: ./common/headers.yaml#/components/parameters/testScenarioHeader

security:
  - User-Restricted:
      - write:self-assessment

requestBody:
  content:
    application/json:
      schema:
        $ref: './schemas/submit_se_adjustments.json'
      examples:
        example-1:
          description: Full Expenses
          value:
            $ref: './examples/adjustments/submit_se_adjustments_full.json'
        example-2:
          description: Consolidated Expenses
          value:
            $ref: './examples/adjustments/submit_se_adjustments_consolidated.json'

responses:
  "200":
    description: Success
    headers:
      X-CorrelationId:
        $ref: './common/headers.yaml#/components/parameters/correlationId'
      Deprecation:
        $ref: './common/headers.yaml#/components/parameters/deprecationHeader'
    content:
      application/json:
        schema:
          $ref: './schemas/submit_adjustments_response.json'
        examples:
          example-1:
            description: Submit Self-Employment Accounting Adjustments
            value:
              $ref: './examples/adjustments/submit_se_adjustment_response.json'

  "400":
    description: Bad Request
    content:
      application/json:
        schema:
          $ref: './schemas/error_response.yaml'
        examples:
          FORMAT_NINO:
            $ref: './common/errors.yaml#/components/examples/formatNino'
          FORMAT_BSAS_ID:
            $ref: './common/errors.yaml#/components/examples/formatBsasId'
          FORMAT_ADJUSTMENT_VALUE:
            $ref: './common/errors.yaml#/components/examples/formatAdjustmentValue'
          INCORRECT_OR_EMPTY_BODY_SUBMITTED:
            $ref: './common/errors.yaml#/components/examples/incorrectOrEmptyBodySubmitted'
          RULE_RANGE_INVALID:
            $ref: './common/errors.yaml#/components/examples/ruleRangeInvalid'
          RULE_BOTH_EXPENSES_SUPPLIED:
            $ref: './common/errors.yaml#/components/examples/ruleBothExpensesSupplied'

  "403":
    description: Forbidden
    content:
      application/json:
        schema:
          $ref: './schemas/error_response.yaml'
        examples:
          RULE_NOT_SELF_EMPLOYMENT:
            $ref: './common/errors.yaml#/components/examples/ruleNotSelfEmployment'
          RULE_SUMMARY_STATUS_INVALID:
            $ref: './common/errors.yaml#/components/examples/ruleSummaryStatusInvalid'
          RULE_SUMMARY_STATUS_SUPERSEDED:
            $ref: './common/errors.yaml#/components/examples/ruleSummaryStatusSuperseded'
          RULE_BSAS_ALREADY_ADJUSTED:
            $ref: './common/errors.yaml#/components/examples/ruleBsasAlreadyAdjusted'
          RULE_OVER_CONSOLIDATED_EXPENSES_THRESHOLD:
            $ref: './common/errors.yaml#/components/examples/ruleOverConsolidatedExpensesThreshold'
          RULE_TRADING_INCOME_ALLOWANCE_CLAIMED:
            $ref: './common/errors.yaml#/components/examples/ruleTradingIncomeAllowanceExceeded'
          RULE_RESULTING_VALUE_NOT_PERMITTED:
            $ref: './common/errors.yaml#/components/examples/ruleResultingValueNotPermitted'
          CLIENT_OR_AGENT_NOT_AUTHORISED:
            $ref: './common/errors.yaml#/components/examples/clientOrAgentNotAuthorised'

  "404":
    description: Not Found
    content:
      application/json:
        schema:
          $ref: './schemas/error_response.yaml'
        examples:
          MATCHING_RESOURCE_NOT_FOUND:
            $ref: './common/errors.yaml#/components/examples/bsasNotFound'